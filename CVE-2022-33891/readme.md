# CVE-2022-33891
## Apache Spark Shell-Command Injection Vulnerability

<hr/>

### Apache Spark
<p>Apache Spark is a multi-language engine for executing data engineering, data science and machine learning on single-node machines or clusters.<br/>
A framework that can quickly perform processing tasts on large data sets and can distribute processing tasks across multiple computers using distributed computing tools.
</p>
<p>Includes following features:
<ul>
    <li>Batch/streaming data</li>
    <li>SQL analytics</li>
    <li>Data science at scale</li>
    <li>Machine Learning</li>
</ul>
</p>

<hr/>

### Vulnerability
<ul>

<li><b> Arbitrary Shell Command Execution </b></li>
<li><b> Base Score: 8.8 HIGH </b></li>


<li><b>Description:</b>
<p>
<ul>

<li>Access Control lists(ACLs) can be enabled in the Apache Spark via the configuration option <i><b> spark.acls.enable </i></b></li>

<li>An authentication filter checks wheter a user has access permissions to view and modify the application</li>

<li>If ACLs are enables, a code path in HttpSecurityFilter can allow someone to perform impersonation by providing an arbitrary user name.</li>

<li>A malicious user might then be able to reach a permission check function that will ultimately build a Unix shell command based on the input and then execute it.</li>

</ul>
</p>
</li>
</ul>

<hr/>

### Working

 
<ul>

<li>Vulnerable Component: <code> http://localhost:8080/doAs=`[command injection]`</code></li>

<li>The commands entered by user are processed through the <i><b>?doAs</i></b> parameter.</li>

<li>No reflection is visible after executing command indicates that this is blind OS injection.</li>

<li>As commands are entered in the URL paramter, <i><b>?doAs</i></b> will trigger background linux bash process to run the process.</li>

<hr/>

### Steps to Exploit (POC)


<hr/>

### Impact

<p>Attacker can establish a reverse shell, where there is a high chance of the adversary getting access to apache spark server.</p>

<hr/>